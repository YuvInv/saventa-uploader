# Dealigence to CRM Field Mapping Reference

## 1. FIELD MAPPING TABLE

### 1.1 Core Company Fields

| Dealigence Field | CRM Field | Data Type | Transformation Required | Validation Rules | Priority |
|------------------|-----------|-----------|------------------------|------------------|----------|
| Company Name (h1) | `CompanyName` | string | None | **REQUIRED**. Max 255 chars | P0 |
| Description (first p) | `Description` | string | Truncate if > 5000 chars | Optional | P0 |
| Website URL | `Website` | url | Clean URL (remove params, trailing slash) | Must be valid URL format | P1 |
| Company LinkedIn | `LinkedInURL` (custom field) | url | None | Must be LinkedIn domain | P2 |

### 1.2 Funding & Stage Fields

| Dealigence Field | CRM Field | Data Type | Transformation Required | Validation Rules | Priority |
|------------------|-----------|-----------|------------------------|------------------|----------|
| Funding Status | `Stage` | dropdown | Map to CRM stage values (see mapping below) | Must match CRM dropdown options | P1 |
| Total Funding | `TotalFunding` (custom field) | string | Parse amount: "$1m" → "1000000" or keep as string | Optional, format: currency | P1 |
| Established | `FoundedDate` | date | Parse "March 2022" → "2022-03-01" | Format: YYYY-MM-DD | P2 |
| ARR | `ARR` (custom field) | string | Parse "$500k" → "500000" | Optional, numeric | P2 |
| Employees | `Employees` (custom field) | number | Parse "7" → 7 | Optional, integer | P2 |

### 1.3 Category & Taxonomy Fields

| Dealigence Field | CRM Field | Data Type | Transformation Required | Validation Rules | Priority |
|------------------|-----------|-----------|------------------------|------------------|----------|
| Categories (first tag) | `Sector` | dropdown | Map to CRM sector (see mapping below) | Must match CRM dropdown | P1 |
| All Categories | `Tags` (custom field) | string | Join with commas: "B2B, Healthcare, SaaS" | Optional | P2 |
| Business Model (B2B/B2C) | `BusinessModel` (custom field) | string | Extract from categories | Optional | P2 |

### 1.4 Source & Notes Fields

| Dealigence Field | CRM Field | Data Type | Transformation Required | Validation Rules | Priority |
|------------------|-----------|-----------|------------------------|------------------|----------|
| Dealigence URL | `SourceURL` (custom field) | url | Direct copy | None | P1 |
| All extracted data | `SourceNotes` | string | Format as readable text (see template below) | Max 10000 chars | P1 |
| Import timestamp | `SourceImportDate` (custom field) | date | Current timestamp | ISO 8601 format | P2 |

### 1.5 Contact/Founder Fields

| Dealigence Field | CRM Contact Field | Data Type | Transformation Required | Validation Rules | Priority |
|------------------|-------------------|-----------|------------------------|------------------|----------|
| Founder Name | `Name` | string | **REQUIRED** if creating contact | Max 255 chars | P1 |
| Founder LinkedIn | `LinkedIn` | url | Direct copy | Must be LinkedIn profile URL | P2 |
| Founder Email | `Email` | email | Not available on Dealigence | N/A | - |
| Founder Phone | `Phone` | string | Not available on Dealigence | N/A | - |
| Contact Type | `ContactTypeID` | dropdown | Set to "FDR" (Founder) | Must match CRM values | P1 |

---

## 2. TRANSFORMATION RULES

### 2.1 Funding Status → CRM Stage Mapping
```typescript
const FUNDING_STATUS_TO_STAGE: Record = {
  'Fundraising': 'Fundraising',
  'Bootstrapped': 'Bootstrapped',
  'Seed': 'Seed',
  'Series A': 'Series A',
  'Series B': 'Series B',
  'Series C': 'Series C',
  'Series D+': 'Series D+',
  'Acquired': 'Acquired',
  'IPO': 'IPO',
  'Shutdown': 'Shutdown',
  // Default fallback
  'default': 'Unknown'
};

function mapFundingStatus(dealigenceStatus: string): string {
  const normalized = dealigenceStatus.toLowerCase().trim();
  
  for (const [key, value] of Object.entries(FUNDING_STATUS_TO_STAGE)) {
    if (normalized.includes(key.toLowerCase())) {
      return value;
    }
  }
  
  return FUNDING_STATUS_TO_STAGE['default'];
}
```

### 2.2 Categories → CRM Sector Mapping
```typescript
const CATEGORY_TO_SECTOR: Record = {
  // Healthcare
  'Healthcare': 'Healthcare',
  'Healthcare Providers': 'Healthcare',
  'Medical Devices': 'Healthcare',
  'Health Diagnostics': 'Healthcare',
  'Treatments': 'Healthcare',
  
  // Technology
  'SaaS': 'SaaS',
  'AI': 'AI/ML',
  'Computer Vision': 'AI/ML',
  'Machine Learning': 'AI/ML',
  'BigData': 'Data & Analytics',
  'Software': 'Software',
  
  // Finance
  'Fintech': 'Fintech',
  'Financial Services': 'Fintech',
  'Payments': 'Fintech',
  
  // Other
  'Manufacturing': 'Manufacturing',
  'Connected Device': 'IoT',
  'Neuroscience': 'Healthcare', // Map to parent category
};

function mapCategoriesTo Sector(categories: string[]): string | undefined {
  for (const category of categories) {
    const mapped = CATEGORY_TO_SECTOR[category];
    if (mapped) {
      return mapped;
    }
  }
  
  // Fallback: return first category if no exact match
  return categories[0];
}
```

### 2.3 Funding Amount Parsing
```typescript
function parseFundingAmount(amount: string): number | null {
  if (!amount) return null;
  
  // Remove currency symbols and whitespace
  const cleaned = amount.replace(/[$£€,\\s]/g, '');
  
  // Parse multipliers
  if (cleaned.toLowerCase().includes('m')) {
    return parseFloat(cleaned) * 1_000_000;
  }
  if (cleaned.toLowerCase().includes('k')) {
    return parseFloat(cleaned) * 1_000;
  }
  if (cleaned.toLowerCase().includes('b')) {
    return parseFloat(cleaned) * 1_000_000_000;
  }
  
  return parseFloat(cleaned);
}

// Examples:
// "$1m" → 1000000
// "$5.2m" → 5200000
// "$500k" → 500000
// "£1.5M" → 1500000
```

### 2.4 Date Parsing
```typescript
function parseEstablishedDate(dateStr: string): string | null {
  if (!dateStr) return null;
  
  // Format: "March 2022" or "January 2015"
  const months: Record = {
    'january': '01', 'february': '02', 'march': '03', 'april': '04',
    'may': '05', 'june': '06', 'july': '07', 'august': '08',
    'september': '09', 'october': '10', 'november': '11', 'december': '12'
  };
  
  const match = dateStr.match(/([a-z]+)\\s+(\\d{4})/i);
  if (!match) return null;
  
  const [, month, year] = match;
  const monthNum = months[month.toLowerCase()];
  
  if (!monthNum) return null;
  
  return `${year}-${monthNum}-01`; // Return first day of month
}

// Examples:
// "March 2022" → "2022-03-01"
// "January 2015" → "2015-01-01"
```

### 2.5 URL Cleaning
```typescript
function cleanWebsiteUrl(url: string): string {
  if (!url) return '';
  
  try {
    const urlObj = new URL(url);
    
    // Remove www prefix
    const hostname = urlObj.hostname.replace(/^www\\./, '');
    
    // Keep only protocol and hostname
    return `${urlObj.protocol}//${hostname}`;
  } catch {
    // If URL parsing fails, return as-is
    return url;
  }
}

// Examples:
// "https://www.example.com/?ref=dealigence" → "https://example.com"
// "http://example.com/about/" → "http://example.com"
```

---

## 3. SOURCE NOTES TEMPLATE

When uploading from Dealigence, populate the `SourceNotes` field with a formatted summary:
```typescript
function formatSourceNotes(data: DealigenceCompanyData): string {
  const sections: string[] = [];
  
  sections.push('=== IMPORTED FROM DEALIGENCE ===');
  sections.push(`Source: ${window.location.href}`);
  sections.push(`Import Date: ${new Date().toISOString()}`);
  sections.push('');
  
  if (data.fundingStatus) {
    sections.push(`Funding Status: ${data.fundingStatus}`);
  }
  
  if (data.totalFunding) {
    sections.push(`Total Funding: ${data.totalFunding}`);
  }
  
  if (data.established) {
    sections.push(`Established: ${data.established}`);
  }
  
  if (data.employees) {
    sections.push(`Employees: ${data.employees}`);
  }
  
  if (data.arr) {
    sections.push(`ARR: ${data.arr}`);
  }
  
  if (data.categories.length > 0) {
    sections.push(`Categories: ${data.categories.join(', ')}`);
  }
  
  if (data.stakeholders.length > 0) {
    sections.push('');
    sections.push('Stakeholders & Advisors:');
    data.stakeholders.forEach(sh => {
      sections.push(`- ${sh.name} (${sh.role})`);
    });
  }
  
  return sections.join('\\n');
}
```

**Example Output:**
```
=== IMPORTED FROM DEALIGENCE ===
Source: https://dealigence.vc/company/eyecuracy
Import Date: 2026-01-29T19:30:00.000Z

Funding Status: Fundraising
Total Funding: $1m
Established: March 2022
Employees: 7
Categories: B2B2C, Healthcare Providers, Computer Vision, SaaS

Stakeholders & Advisors:
- Michelle Hua (Advisory Board Member)
- Carl Korobkin (Advisor, Strategic Business Development)
```

---

## 4. VALIDATION RULES

### 4.1 Required Fields
```typescript
const REQUIRED_FIELDS = {
  deal: ['CompanyName'],
  contact: ['Name', 'ContactTypeID'] // Only if creating contact
};

function validateDeal(data: Partial<Deal>): ValidationResult {
  const errors: ValidationError[] = [];
  
  if (!data.CompanyName || data.CompanyName.trim().length === 0) {
    errors